"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[2799],{2083:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>l,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"operator-guide/commission-governance","title":"Commission and Governance","description":"Guide to managing storage node commission collection and governance operations including authorization and contract upgrades.","source":"@site/../content/operator-guide/commission-governance.mdx","sourceDirName":"operator-guide","slug":"/operator-guide/commission-governance","permalink":"/docs/operator-guide/commission-governance","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/operator-guide/commission-governance.mdx","tags":[],"version":"current","frontMatter":{"title":"Commission and Governance","description":"Guide to managing storage node commission collection and governance operations including authorization and contract upgrades.","keywords":["walrus","commission","governance","storage node","authorization","contract upgrades","voting","node operations"]},"sidebar":"docsSidebar","previous":{"title":"Operating a Storage Node","permalink":"/docs/operator-guide/storage-node"},"next":{"title":"Backup and Restore Guide","permalink":"/docs/operator-guide/backup-restore-guide"}}');var a=t(2714),r=t(8885);const s={title:"Commission and Governance",description:"Guide to managing storage node commission collection and governance operations including authorization and contract upgrades.",keywords:["walrus","commission","governance","storage node","authorization","contract upgrades","voting","node operations"]},i=void 0,d={},c=[{value:"Update the Commission Receiver and Entity Authorized for Governance",id:"update-the-commission-receiver-and-entity-authorized-for-governance",level:2},{value:"Using the CLI",id:"using-the-cli",level:3},{value:"Using the Web Interface",id:"using-the-web-interface",level:3},{value:"Collecting Commission",id:"collecting-commission",level:2},{value:"Contract Upgrades",id:"contract-upgrades",level:2},{value:"Voting for Quorum-Based Upgrades",id:"voting-for-quorum-based-upgrades",level:3},{value:"Computing the Upgrade Digest",id:"computing-the-upgrade-digest",level:4},{value:"Voting on Upgrades Using the Web Interface",id:"voting-on-upgrades-using-the-web-interface",level:4},{value:"Voting on Upgrades Using the CLI",id:"voting-on-upgrades-using-the-cli",level:4},{value:"Upgrade Completion",id:"upgrade-completion",level:4}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",ol:"ol",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Term:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(n.p,{children:["While most node parameters can be changed using the StorageNodeCap and are automatically updated\nbased on the values in the node configuration, authorization for contract upgrades and for\nwithdrawing the ",(0,a.jsx)(t,{lookup:"Storage node",children:"storage node"})," commission is handled separately, to ensure that the hot wallet on the\n","storage node"," does not need to be authorized for these operations."]}),"\n",(0,a.jsxs)(n.p,{children:["We strongly recommend to all node operators to designate secure wallets for these operations that\nare not stored on the ","storage node"," machines."]}),"\n",(0,a.jsx)(n.p,{children:"This page explains how to update the entities that are authorized for governance (i.e. contract\nupgrade) and commission operations and how these operations are performed."}),"\n",(0,a.jsx)(n.h2,{id:"update-the-commission-receiver-and-entity-authorized-for-governance",children:"Update the Commission Receiver and Entity Authorized for Governance"}),"\n",(0,a.jsx)(n.p,{children:"It is possible to either designate an arbitrary object as a capability for governance/commission\noperations or to designate an address to be authorized."}),"\n",(0,a.jsx)(n.admonition,{type:"warning",children:(0,a.jsx)(n.p,{children:"Once set, only the authorized entity (either based on the address or capability) can\nchange the authorization again, so only set it to addresses/objects that you control and make sure\nthey remain accessible."})}),"\n",(0,a.jsxs)(n.p,{children:["To set the authorization to receive the commission and perform governance operations you can either\nuse the ",(0,a.jsx)(n.code,{children:"walrus"})," binary in your CLI, or you can use the ",(0,a.jsx)(n.a,{href:"https://stake-wal.wal.app/node-operations",children:"node operations web interface"}),"."]}),"\n",(0,a.jsx)(n.h3,{id:"using-the-cli",children:"Using the CLI"}),"\n",(0,a.jsxs)(n.p,{children:["The following assumes that you have the ",(0,a.jsx)(n.code,{children:"walrus"})," binary ",(0,a.jsx)(n.a,{href:"/docs/usage/setup",children:"correctly set up"}),", using\nthe wallet that is currently authorized to perform these operations. If this is the first time\nupdating the authorized entities, this will be the wallet that you used to setup the ","storage node",".\nTo specify a wallet and/or config that are not in the standard locations, you can specify them using\nthe ",(0,a.jsx)(n.code,{children:"--wallet"})," and ",(0,a.jsx)(n.code,{children:"--config"})," command line arguments."]}),"\n",(0,a.jsx)(n.p,{children:"Note that the authorized entities for commission and governance are independent, i.e., they do not\nneed to be set to the same address or object."}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ NODE_ID=            # Set this to your node ID.\n$ COMMISSION_AUTHORIZED_ADDRESS= # Set this to a secure wallet address that you control.\n$ GOVERNANCE_AUTHORIZED_ADDRESS= # Set this to a secure wallet address that you control.\n$ walrus node-admin set-commission-authorized --node-id $NODE_ID --address $COMMISSION_AUTHORIZED_ADDRESS\n$ walrus node-admin set-governance-authorized --node-id $NODE_ID --address $GOVERNANCE_AUTHORIZED_ADDRESS\n"})}),"\n",(0,a.jsxs)(n.p,{children:["Instead of specifying an authorized address using the ",(0,a.jsx)(n.code,{children:"--address"})," flag, an arbitrary object can be\ndesignated as capability, using the ",(0,a.jsx)(n.code,{children:"--object"})," flag:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ NODE_ID=           # Set this to your node ID.\n$ COMMISSION_AUTHORIZED_OBJECT= # Set this to the ID of an object that you own in a secure wallet.\n$ GOVERNANCE_AUTHORIZED_OBJECT= # Set this to the ID of an object that you own in a secure wallet.\n$ walrus node-admin set-commission-authorized --node-id $NODE_ID --object $COMMISSION_AUTHORIZED_OBJECT\n$ walrus node-admin set-governance-authorized --node-id $NODE_ID --object $GOVERNANCE_AUTHORIZED_OBJECT\n"})}),"\n",(0,a.jsx)(n.h3,{id:"using-the-web-interface",children:"Using the Web Interface"}),"\n",(0,a.jsxs)(n.p,{children:["Go to the ",(0,a.jsx)(n.a,{href:"https://stake-wal.wal.app/node-operations",children:"operator panel on the staking dApp"}),", connect\nyour wallet and select your node either through the drop-down menu or by pasting your node ID.\nThen select ",(0,a.jsx)(n.code,{children:"Set Commission Receiver"})," or ",(0,a.jsx)(n.code,{children:"Set Governance Authorized"})," and follow the steps to send\nthe transaction."]}),"\n",(0,a.jsx)(n.h2,{id:"collecting-commission",children:"Collecting Commission"}),"\n",(0,a.jsxs)(n.p,{children:["To collect your commission, you can again either use the CLI or the web interface. To use the CLI,\nmake sure that ",(0,a.jsx)(n.code,{children:"walrus"})," is configured to use the authorized wallet and run the following command:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ NODE_ID=           # Set this to your node ID.\n$ walrus node-admin --node-id $NODE_ID collect-commission\n"})}),"\n",(0,a.jsxs)(n.p,{children:["To use the web interface, go to the\n",(0,a.jsx)(n.a,{href:"https://stake-wal.wal.app/node-operations",children:"operator panel on the staking dApp"}),", connect\nyour wallet and select your node either through the drop-down menu or by pasting your node ID.\nThen select ",(0,a.jsx)(n.code,{children:"Collect Commission"})," and follow the steps to send the transaction."]}),"\n",(0,a.jsx)(n.h2,{id:"contract-upgrades",children:"Contract Upgrades"}),"\n",(0,a.jsx)(n.p,{children:"Contract upgrades in Walrus are managed through a quorum-based voting system. This ensures that\nupgrades are only applied after sufficient consensus among node operators. The process requires\ncomputing a digest of the proposed upgrade and voting on it."}),"\n",(0,a.jsx)(n.h3,{id:"voting-for-quorum-based-upgrades",children:"Voting for Quorum-Based Upgrades"}),"\n",(0,a.jsxs)(n.p,{children:["When a contract upgrade is proposed, the proposer will generally share the code of the proposed\nupgrade with other node operators. For example, if the Walrus Foundation proposes an upgrade, it\nwill share a specific commit hash in a branch on the ",(0,a.jsx)(n.a,{href:"https://github.com/MystenLabs/walrus",children:"Walrus GitHub Repository"}),"\nthat contains the proposed change in either the ",(0,a.jsx)(n.code,{children:"testnet-contracts/walrus"})," or the\n",(0,a.jsx)(n.code,{children:"mainnet-contracts/walrus"})," directory, depending on whether the Testnet or Mainnet contracts are\nbeing upgraded."]}),"\n",(0,a.jsx)(n.p,{children:"The vote needs to complete within one epoch, otherwise the committee changes and the vote needs to\nbe repeated. To vote for an upgrade, complete the following steps."}),"\n",(0,a.jsx)(n.h4,{id:"computing-the-upgrade-digest",children:"Computing the Upgrade Digest"}),"\n",(0,a.jsxs)(n.p,{children:["Operators should compute the package digest of the package to upgrade. It is important here that\nthe same compiler version is used and the correct Sui network is specified. If you use a standard\n",(0,a.jsx)(n.a,{href:"/docs/usage/setup#configuration",children:"Walrus Configuration"}),", the Sui network will be selected\nautomatically when specifying the Walrus network using the ",(0,a.jsx)(n.code,{children:"--context"})," flag and using the up-to-date\n",(0,a.jsx)(n.code,{children:"walrus"})," version will ensure that the compiler version is consistent across all voters."]}),"\n",(0,a.jsxs)(n.p,{children:["To compute the digest of a proposed upgrade, you should use the ",(0,a.jsx)(n.code,{children:"walrus node-admin"})," command.\nAssuming that your current working directory is the root of the Walrus repository and you have\nchecked out the correct commit, you would use the following command for Testnet upgrades:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ walrus node-admin package-digest --package-path testnet-contracts/walrus --context testnet\n"})}),"\n",(0,a.jsx)(n.p,{children:"And the following for Mainnet upgrades:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ walrus node-admin package-digest --package-path mainnet-contracts/walrus --context mainnet\n"})}),"\n",(0,a.jsx)(n.p,{children:"The command outputs a digest (as Hex and Base64) that you can use to verify the proposal and\nvote on the upgrade."}),"\n",(0,a.jsx)(n.h4,{id:"voting-on-upgrades-using-the-web-interface",children:"Voting on Upgrades Using the Web Interface"}),"\n",(0,a.jsx)(n.p,{children:"Voting on an upgrade using the web interface is the easiest way and also allows you to use any\nwallet supported by your browser (e.g. hardware wallets) To vote through the web interface:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:["Go to the ",(0,a.jsx)(n.a,{href:"https://stake-wal.wal.app/node-operations",children:"operator panel on the staking dApp"}),"."]}),"\n",(0,a.jsx)(n.li,{children:"Connect your wallet and select your node."}),"\n",(0,a.jsx)(n.li,{children:'Navigate to the "Vote on Upgrade" section.'}),"\n",(0,a.jsx)(n.li,{children:"Paste the Base64 package digest from the previous step."}),"\n",(0,a.jsx)(n.li,{children:"Follow the prompts to submit your vote."}),"\n"]}),"\n",(0,a.jsx)(n.h4,{id:"voting-on-upgrades-using-the-cli",children:"Voting on Upgrades Using the CLI"}),"\n",(0,a.jsxs)(n.p,{children:["To vote on an upgrade using the CLI, ensure that your ",(0,a.jsx)(n.code,{children:"walrus"})," binary is configured with the authorized\nwallet, and that you are on the correct branch in the root directory of the Walrus repository.\nThen run the following for Testnet:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ NODE_ID=   # Set this to your node ID.\n$ PACKAGE_PATH=testnet-contracts/walrus\n$ UPGRADE_MANAGER_OBJECT_ID=0xc768e475fd1527b7739884d7c3a3d1bc09ae422dfdba6b9ae94c1f128297283c\n$ walrus node-admin vote-for-upgrade \\\n    --node-id $NODE_ID \\\n    --upgrade-manager-object-id $UPGRADE_MANAGER_OBJECT_ID \\\n    --package-path $PACKAGE_PATH \\\n    --context testnet\n"})}),"\n",(0,a.jsx)(n.p,{children:"And for Mainnet upgrades:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sh",children:"$ NODE_ID=   # Set this to your node ID.\n$ PACKAGE_PATH=mainnet-contracts/walrus\n$ UPGRADE_MANAGER_OBJECT_ID=0xc42868ad4861f22bd1bcd886ae1858d5c007458f647a49e502d44da8bbd17b51\n$ walrus node-admin vote-for-upgrade \\\n    --node-id $NODE_ID \\\n    --upgrade-manager-object-id $UPGRADE_MANAGER_OBJECT_ID \\\n    --package-path $PACKAGE_PATH \\\n    --context mainnet\n"})}),"\n",(0,a.jsx)(n.h4,{id:"upgrade-completion",children:"Upgrade Completion"}),"\n",(0,a.jsxs)(n.p,{children:["After a quorum of node operators (by number of shards) has voted in favor of a proposal, the contract\nupgrade can be finalized. This will usually be done by the proposer using a PTB that calls the\nrespective functions to authorize, execute, and commit the upgrade. Then, depending on the upgrade,\neither at the start of the next epoch or immediately, the system and staking objects are migrated to\nthe new version, by calling the ",(0,a.jsx)(n.code,{children:"migrate"})," function in the ",(0,a.jsx)(n.code,{children:"init"})," module of the ",(0,a.jsx)(n.code,{children:"walrus"})," package.\nThe upgrade and migration can both be performed using the ",(0,a.jsx)(n.code,{children:"walrus-deploy"})," binary."]})]})}function l(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(h,{...e})}):h(e)}},8885:(e,n,t)=>{t.d(n,{R:()=>s,x:()=>i});var o=t(9378);const a={},r=o.createContext(a);function s(e){const n=o.useContext(r);return o.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:s(e.components),o.createElement(r.Provider,{value:n},e.children)}}}]);