"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[8691],{4781:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>t,default:()=>u,frontMatter:()=>o,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"operator-guide/backup-restore-guide","title":"Backup and Restore Guide","description":"Comprehensive guide for backing up and restoring Walrus storage node databases with automated and manual procedures.","source":"@site/../content/operator-guide/backup-restore-guide.mdx","sourceDirName":"operator-guide","slug":"/operator-guide/backup-restore-guide","permalink":"/docs/operator-guide/backup-restore-guide","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/operator-guide/backup-restore-guide.mdx","tags":[],"version":"current","frontMatter":{"title":"Backup and Restore Guide","description":"Comprehensive guide for backing up and restoring Walrus storage node databases with automated and manual procedures.","keywords":["walrus","backup","restore","storage node","database","recovery","checkpoint","administration","operations"]},"sidebar":"docsSidebar","previous":{"title":"Commission and Governance","permalink":"/docs/operator-guide/commission-governance"},"next":{"title":"The Walrus Upload Relay","permalink":"/docs/operator-guide/upload-relay"}}');var i=s(2714),a=s(8885);const o={title:"Backup and Restore Guide",description:"Comprehensive guide for backing up and restoring Walrus storage node databases with automated and manual procedures.",keywords:["walrus","backup","restore","storage node","database","recovery","checkpoint","administration","operations"]},t=void 0,c={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Local Administration Socket Configuration",id:"local-administration-socket-configuration",level:3},{value:"Automated Periodic Backups",id:"automated-periodic-backups",level:2},{value:"Manual Backup Creation",id:"manual-backup-creation",level:2},{value:"List Available Backups",id:"list-available-backups",level:2},{value:"Restore From a Backup",id:"restore-from-a-backup",level:2}];function l(e){const n={admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...e.components},{Term:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Walrus ",(0,i.jsx)(s,{lookup:"Storage node",children:"storage nodes"})," provide backup and restore functionality for the primary database containing\n",(0,i.jsx)(s,{lookup:"Blob",children:"blob"})," data. This guide covers configuration requirements, operational procedures, and best practices\nfor both automated and manual backup processes, as well as restore operations."]}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsx)(n.p,{children:"The current backup implementation creates full copies of the database files. This means backups\nrequire substantial disk space (approximately the same size as your active database). A\ncheckpoint-based solution is planned for a future release."})}),"\n",(0,i.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Storage node"," must be running with appropriate permissions to create backups"]}),"\n",(0,i.jsx)(n.li,{children:"Sufficient disk space for backup storage (recommended: separate physical volume)"}),"\n",(0,i.jsx)(n.li,{children:"Unix/Linux operating system with support for Unix domain sockets"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"walrus"}),(0,i.jsx)(s,{lookup:"User",children:"user"})," account with appropriate permissions"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"local-administration-socket-configuration",children:"Local Administration Socket Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["The backup system communicates with running ","storage nodes"," through a Unix domain socket. To enable\nthis functionality:"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Configure the administration socket path"})," in your node configuration file:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"admin_socket_path: /opt/walrus/admin.socket\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Restart the ","storage node"]})," to initialize the socket:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo systemctl restart walrus-node.service\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Verify socket creation"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ ls -la /opt/walrus/admin.socket\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.admonition,{type:"warning",children:[(0,i.jsxs)(n.p,{children:["The ","storage node"," creates the socket with permissions ",(0,i.jsx)(n.code,{children:"srw------- 1 walrus walrus"}),", ensuring\nthat only the ",(0,i.jsx)(n.code,{children:"walrus"}),"user"," can send operations to it. This is critical for security, as\noperations sent to this socket are executed directly on the running ","storage node","."]}),(0,i.jsx)(n.p,{children:"Currently supported operations include:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"local-admin checkpoint"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.strong,{children:"local-admin log-level"})}),"\n"]})]}),"\n",(0,i.jsx)(n.h2,{id:"automated-periodic-backups",children:"Automated Periodic Backups"}),"\n",(0,i.jsxs)(n.p,{children:["Storage nodes"," support scheduled automatic backups through checkpoint configuration. Add the\nfollowing configs to your node configuration:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"checkpoint_config:\n  # Directory where backups will be stored\n  db_checkpoint_dir: /opt/walrus/checkpoints\n\n  # Number of backups to retain (oldest will be deleted)\n  max_db_checkpoints: 2\n\n  # Backup frequency (example: 4-hour interval)\n  db_checkpoint_interval:\n    secs: 14400  # 4 hours in seconds\n    nanos: 0\n\n  # Sync in-memory data to disk before creating a backup\n  sync: true\n\n  # Maximum concurrent backup operations\n  max_background_operations: 1\n\n  # Enable/disable automated backups\n  periodic_db_checkpoints: true\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["To disable automated backups, set ",(0,i.jsx)(n.code,{children:"periodic_db_checkpoints: false"})," in your configuration."]})}),"\n",(0,i.jsx)(n.h2,{id:"manual-backup-creation",children:"Manual Backup Creation"}),"\n",(0,i.jsxs)(n.p,{children:["Create on-demand backups using the ",(0,i.jsx)(n.code,{children:"local-admin"})," command:"]}),"\n",(0,i.jsxs)(n.admonition,{type:"info",children:[(0,i.jsxs)(n.p,{children:["The following commands assume ",(0,i.jsx)(n.code,{children:"walrus-node"})," is in your system's PATH. If it's not, replace\n",(0,i.jsx)(n.code,{children:"walrus-node"})," with the full path to the binary, for example:"]}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"/opt/walrus/bin/walrus-node"})}),"\n"]})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"# Basic backup command\n$ sudo -u walrus walrus-node local-admin \\\n    --socket-path /opt/walrus/admin.socket \\\n    checkpoint create \\\n    --path /opt/walrus/backups/manual-backup-name\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["The backup operation runs in the background within the ","storage node",". Once the backup creation is\ninitialized, the process continues independently even if the command-line interface is terminated."]})}),"\n",(0,i.jsx)(n.h2,{id:"list-available-backups",children:"List Available Backups"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo -u walrus walrus-node local-admin \\\n    --socket-path /opt/walrus/admin.socket \\\n    checkpoint list \\\n    --path /opt/walrus/checkpoints\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Sample output:"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"Backups:\nBackup ID: 1, Size: 85.9 GB, Files: 1055, Created: 2025-07-02T00:25:48Z\nBackup ID: 2, Size: 86.2 GB, Files: 1058, Created: 2025-07-02T04:25:52Z\n"})}),"\n",(0,i.jsx)(n.h2,{id:"restore-from-a-backup",children:"Restore From a Backup"}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["Do not copy backup directories directly to the ","storage node","'s data path. The restore tool must be\nused to properly reconstruct the database from checkpoint files. Directly copied content cannot be\nrecognized by the storage engine."]})}),"\n",(0,i.jsx)(n.p,{children:"Follow these steps to restore from a backup:"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Stop the ","storage node"," service"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo systemctl stop walrus-node.service\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Verify the service is stopped"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo systemctl status walrus-node.service\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Optional: Backup current database"}),"\nAssuming the Walrus storage path is: ",(0,i.jsx)(n.code,{children:"storage_path: /opt/walrus/db"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo -u walrus cp -r /opt/walrus/db /opt/walrus/db.backup.$(date +%Y%m%d-%H%M%S)\n"})}),"\n",(0,i.jsx)(n.p,{children:"This command saves:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Main database files"}),"\n",(0,i.jsxs)(n.li,{children:["Events database (",(0,i.jsx)(n.code,{children:"/opt/walrus/db/events/"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Event ","blob"," data (",(0,i.jsx)(n.code,{children:"/opt/walrus/db/event_blob_writer/"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Clear existing data"})," (if performing a clean restore):"]}),"\n",(0,i.jsx)(n.p,{children:"Remove all existing database files to ensure a clean restore,"}),"\n",(0,i.jsxs)(n.p,{children:["Assuming the Walrus storage path is: ",(0,i.jsx)(n.code,{children:"storage_path: /opt/walrus/db"}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo -u walrus rm -rf /opt/walrus/db/*\n"})}),"\n",(0,i.jsx)(n.p,{children:"This command removes:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Main database files"}),"\n",(0,i.jsxs)(n.li,{children:["Events database (",(0,i.jsx)(n.code,{children:"/opt/walrus/db/events/"}),")"]}),"\n",(0,i.jsxs)(n.li,{children:["Event ","blob"," data (",(0,i.jsx)(n.code,{children:"/opt/walrus/db/event_blob_writer/"}),")"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Restore main database"}),":"]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["The restore process can take significant time depending on database size. Run the restore command\nin a persistent session using ",(0,i.jsx)(n.code,{children:"tmux"})," or ",(0,i.jsx)(n.code,{children:"screen"})," to prevent interruption if your connection drops."]})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["As mentioned earlier, if ",(0,i.jsx)(n.code,{children:"walrus-node"})," is not in your PATH, use the full path to the binary."]})}),"\n",(0,i.jsx)(n.p,{children:"Restore from specific checkpoint:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo -u walrus walrus-node \\\n    restore \\\n    --db-checkpoint-path /opt/walrus/checkpoints \\\n    --db-path /opt/walrus/db \\\n    --checkpoint-id 2\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Or restore from latest checkpoint (omit ",(0,i.jsx)(n.code,{children:"--checkpoint-id"}),"):"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo -u walrus walrus-node \\\n    restore \\\n    --db-checkpoint-path /opt/walrus/checkpoints \\\n    --db-path /opt/walrus/db\n"})}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsxs)(n.strong,{children:["Start the ","storage node"]}),":"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo systemctl start walrus-node.service\n"})}),"\n",(0,i.jsx)(n.p,{children:"Monitor startup logs:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-sh",children:"$ sudo journalctl -u walrus-node.service -f\n"})}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["The ","storage node"," will begin downloading and replaying events. This process may take some time before\nthe node transitions to ",(0,i.jsx)(n.code,{children:"Active"})," state."]})]})}function u(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},8885:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>t});var r=s(9378);const i={},a=r.createContext(i);function o(e){const n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:o(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);