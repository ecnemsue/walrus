"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[8697],{4166:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>b,contentTitle:()=>w,default:()=>S,frontMatter:()=>g,metadata:()=>s,toc:()=>y});const s=JSON.parse('{"id":"walrus-sites/portal","title":"The Walrus Sites Portal","description":"Guide to Walrus Sites portals including server-side, service-worker portals, local deployment, and configuration options.","source":"@site/../content/walrus-sites/portal.mdx","sourceDirName":"walrus-sites","slug":"/walrus-sites/portal","permalink":"/docs/walrus-sites/portal","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/walrus-sites/portal.mdx","tags":[],"version":"current","frontMatter":{"title":"The Walrus Sites Portal","description":"Guide to Walrus Sites portals including server-side, service-worker portals, local deployment, and configuration options.","keywords":["walrus sites","portal","server-side portal","service worker","local deployment","configuration","hosting","docker"]},"sidebar":"sitesSidebar","previous":{"title":"Technical Overview","permalink":"/docs/walrus-sites/overview"},"next":{"title":"Bringing Your Own Domain","permalink":"/docs/walrus-sites/bring-your-own-domain"}}');var l=r(2714),o=r(8885),t=r(9378),i=r(6210);const a="container_cKnO",c="title_L86B",d="portalsList_UKoR",h="portalItem_WGIT",p="portalContent_o5yI",u="portalUrl_dKdA",x="portalOperator_yrBG",j="loading_wgIq",v="error_co6O",m="empty_tnEu",f=()=>{const[e,n]=(0,t.useState)([]),[r,s]=(0,t.useState)(!0),[o,f]=(0,t.useState)(null),g=(0,i.Ay)("/portals.json");return(0,t.useEffect)(()=>{(async()=>{try{const e=await fetch(g);if(!e.ok)throw new Error("Failed to fetch portals data");const r=await e.json(),l=Object.entries(r.portals).map(([e,n])=>({url:e,operator:n.operator}));n(l),s(!1)}catch(e){f(e instanceof Error?e.message:"Unknown error occurred"),s(!1)}})()},[]),r?(0,l.jsx)("div",{className:j,children:"Loading portals..."}):o?(0,l.jsxs)("div",{className:v,children:["Error: ",o]}):0===e.length?(0,l.jsx)("div",{className:m,children:"No portals available"}):(0,l.jsxs)("div",{className:a,children:[(0,l.jsx)("h3",{className:c,children:"Available Portals"}),(0,l.jsx)("ul",{className:d,children:e.map(e=>(0,l.jsx)("li",{className:h,children:(0,l.jsxs)("div",{className:p,children:[(0,l.jsx)("a",{href:e.url,target:"_blank",rel:"noopener noreferrer",className:u,children:e.url}),(0,l.jsxs)("span",{className:x,children:["Operated by: ",e.operator]})]})},e.url))})]})},g={title:"The Walrus Sites Portal",description:"Guide to Walrus Sites portals including server-side, service-worker portals, local deployment, and configuration options.",keywords:["walrus sites","portal","server-side portal","service worker","local deployment","configuration","hosting","docker"]},w=void 0,b={},y=[{value:"Known portals",id:"known-portals",level:2},{value:"Running a local portal",id:"running-a-local-portal",level:2},{value:"Configuration",id:"configuration",level:3},{value:"Environment Variables",id:"environment-variables",level:4},{value:"Mainnet Server Portal Environment Variables",id:"mainnet-server-portal-environment-variables",level:5},{value:"Testnet Server Portal Environment Variables",id:"testnet-server-portal-environment-variables",level:5},{value:"Mainnet Service Worker Portal Environment Variables",id:"mainnet-service-worker-portal-environment-variables",level:5},{value:"Testnet Service Worker Portal Environment Variables",id:"testnet-service-worker-portal-environment-variables",level:5},{value:"Constants",id:"constants",level:4},{value:"Deploying the Portal",id:"deploying-the-portal",level:3},{value:"Docker",id:"docker",level:4},{value:"Local Development",id:"local-development",level:4},{value:"Next Steps",id:"next-steps",level:2}];function k(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components},{Term:r}=n;return r||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)(n.p,{children:['We use the term "portal" to indicate any technology that is used to access and browse Walrus Sites.\nAs mentioned in the ',(0,l.jsx)(n.a,{href:"/docs/walrus-sites/overview#the-site-rendering-path",children:"overview"}),", we foresee three kinds of\nportals:"]}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"server-side portals;"}),"\n",(0,l.jsx)(n.li,{children:"custom local apps; and"}),"\n",(0,l.jsx)(n.li,{children:"service-worker based portals running in the browser."}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["Currently, only a server-side portal is served at ",(0,l.jsx)(n.a,{href:"https://wal.app",children:"https://wal.app"}),"."]}),"\n",(0,l.jsx)(n.admonition,{title:"Important: Testnet Portal Access",type:"warning",children:(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://wal.app",children:"https://wal.app"})," only serves sites deployed on mainnet, linked with SuiNS names.\nYou can run a portal to access mainnet sites as well.\nWalrus Foundation does not maintain a Portal that serves testnet Walrus Sites.\nTo access Sites deployed on testnet you can either use a thirdparty testnet portal,\nself-host one or run one locally."]})}),"\n",(0,l.jsx)(n.p,{children:"We maintain a list of known portals. New portals can self-identify by opening a PR to add themselves\nto the list."}),"\n",(0,l.jsx)(n.h2,{id:"known-portals",children:"Known portals"}),"\n",(0,l.jsxs)(n.p,{children:["Portals can self-identify by opening a PR that adds an entry to ",(0,l.jsx)(n.code,{children:"docs/book/portals/list.json"}),"."]}),"\n","\n",(0,l.jsx)(f,{}),"\n",(0,l.jsx)(n.admonition,{title:"Hosting of the service worker",type:"note",children:(0,l.jsxs)(n.p,{children:["The service-worker portal is no longer hosted, but you can still run it locally. Its code is\navailable in the ",(0,l.jsx)(n.code,{children:"walrus-sites"})," repository. For more information, see\n",(0,l.jsx)(n.a,{href:"#running-a-local-portal",children:"running a local portal"}),"."]})}),"\n",(0,l.jsx)(n.admonition,{title:"Walrus Sites stable branch",type:"danger",children:(0,l.jsxs)(n.p,{children:["The stable branch of Walrus Sites is ",(0,l.jsx)(n.code,{children:"mainnet"}),"."]})}),"\n",(0,l.jsx)(n.h2,{id:"running-a-local-portal",children:"Running a local portal"}),"\n",(0,l.jsx)(n.p,{children:"Running a portal locally can be useful, for example if you want to browse Walrus Sites without\naccessing external portals, or for development purposes."}),"\n",(0,l.jsxs)(n.p,{children:["Let's start by cloning the ",(0,l.jsx)(n.code,{children:"walrus-sites"})," repository:"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ git clone https://github.com/MystenLabs/walrus-sites.git\n$ cd walrus-sites\n"})}),"\n",(0,l.jsx)(n.p,{children:"Make sure you are on the stable branch:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ git checkout mainnet\n"})}),"\n",(0,l.jsx)(n.p,{children:"Next, we will see how to configure the portal so it can support the functionality that\nwe need."}),"\n",(0,l.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,l.jsx)(n.p,{children:"Portal configuration is managed through two key elements:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Environment variables: Required for basic functionality."}),"\n",(0,l.jsx)(n.li,{children:"Constants file: Optional for advanced customization."}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,l.jsxs)(n.p,{children:["The environment variables are set in the ",(0,l.jsx)(n.code,{children:".env.local"})," file at the root of each portal directory.\nTo just run a simple instance of a portal, you can use the environment variables specified\nin the ",(0,l.jsx)(n.code,{children:".env.<network>.example"})," file:"]}),"\n",(0,l.jsx)(n.h5,{id:"mainnet-server-portal-environment-variables",children:"Mainnet Server Portal Environment Variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/server/.env.mainnet.example ./portal/server/.env.local\n"})}),"\n",(0,l.jsx)(n.h5,{id:"testnet-server-portal-environment-variables",children:"Testnet Server Portal Environment Variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/server/.env.testnet.example ./portal/server/.env.local\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Likewise, if you want to run the service-worker portal, you can copy the ",(0,l.jsx)(n.code,{children:".env.<network>.example"}),"\nfile to ",(0,l.jsx)(n.code,{children:".env.local"})," in the ",(0,l.jsx)(n.code,{children:"portal/worker"})," directory."]}),"\n",(0,l.jsx)(n.h5,{id:"mainnet-service-worker-portal-environment-variables",children:"Mainnet Service Worker Portal Environment Variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/worker/.env.mainnet.example ./portal/worker/.env.local\n"})}),"\n",(0,l.jsx)(n.h5,{id:"testnet-service-worker-portal-environment-variables",children:"Testnet Service Worker Portal Environment Variables"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cp ./portal/worker/.env.testnet.example ./portal/worker/.env.local\n"})}),"\n",(0,l.jsxs)(n.p,{children:["For a more detailed configuration, you can modify the ",(0,l.jsx)(n.code,{children:".env.local"})," files to suit your needs.\nAs a reference, here are the definitions of the environment variables:"]}),"\n",(0,l.jsx)(n.admonition,{type:"note",children:(0,l.jsxs)(n.p,{children:["The server portal code contains additional functionality that can be enabled or disabled\nusing environment variables. For example, you can enable or disable the blocklist feature\nby setting the ",(0,l.jsx)(n.code,{children:"ENABLE_BLOCKLIST"})," variable to ",(0,l.jsx)(n.code,{children:"true"})," or ",(0,l.jsx)(n.code,{children:"false"}),". This can be helpful to\nmanage the behavior of the portal. For example, if you host a publicly-accessible portal, you might want to avoid serving sites that are not published by you."]})}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"AGGREGATOR_URL"}),": The url to a Walrus ",(0,l.jsx)(r,{lookup:"Aggregator",children:"aggregator"})," that will fetch the site resources from Walrus."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"AMPLITUDE_API_KEY"}),": Provide it if you want to enable ",(0,l.jsx)(n.a,{href:"https://amplitude.com/",children:"Amplitude"})," for your\nserver analytics."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"EDGE_CONFIG"}),": If you host your portal on Vercel, you can use the ",(0,l.jsx)(n.a,{href:"https://vercel.com/docs/edge-config",children:"Edge Config"})," to\nblocklist certain SuiNS subdomains or b36 object ids."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"EDGE_CONFIG_ALLOWLIST"}),": Similar to blocklist, but allows certain subdomains to use the premium\nrpc url list."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_ALLOWLIST"}),": Enable the allowlist feature."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_BLOCKLIST"}),": Enable the blocklist feature."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_SENTRY"}),": Enable Sentry error tracking."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"ENABLE_VERCEL_WEB_ANALYTICS"}),": Enable Vercel web analytics."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"LANDING_PAGE_OID_B36"}),": The b36 object id of the landing page Walrus Site. i.e. the page you get\nwhen you visit ",(0,l.jsx)(n.code,{children:"localhost:3000"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"PORTAL_DOMAIN_NAME_LENGTH"}),": If you connect your portal with a domain name, specify the length of\nthe domain name. e.g. ",(0,l.jsx)(n.code,{children:"example.com"})," has a length of 11."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"PREMIUM_RPC_URL_LIST"}),": A list of rpc urls that are used when a site belongs to the allowlist."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"RPC_URL_LIST"}),": A list of rpc urls that are used when a site does not belong to the allowlist."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SENTRY_AUTH_TOKEN"}),": If you enable Sentry error tracking, provide your Sentry auth token."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SENTRY_DSN"}),": If you enable Sentry error tracking, provide your Sentry DSN."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SENTRY_TRACES_SAMPLE_RATE"}),": If you enable Sentry error tracking, provide the sample rate for\ntraces."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SITE_PACKAGE"}),": The Walrus Site package id. Depending on the network you are using, you will\nhave to specify the correct package id."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SUINS_CLIENT_NETWORK"}),": The network of the SuiNS ",(0,l.jsx)(r,{lookup:"Client",children:"client"}),"."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"B36_DOMAIN_RESOLUTION_SUPPORT"}),": Define if b36 domain resolution is supported. Otherwise the\nsite will not be served."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"constants",children:"Constants"}),"\n",(0,l.jsxs)(n.p,{children:["You can find the ",(0,l.jsx)(n.code,{children:"constants.ts"})," file in the ",(0,l.jsx)(n.code,{children:"portal/common/lib"})," directory. It holds key\nconfiguration parameters for the portal. Typically, you won't need to modify these, but if you do,\nhere are the explanations for each parameter:"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"MAX_REDIRECT_DEPTH"}),": The number of ",(0,l.jsx)(n.a,{href:"/docs/walrus-sites/redirects",children:"redirects"})," the portal will follow\nbefore stopping."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"SITE_NAMES"}),": Hard coded ",(0,l.jsx)(n.code,{children:"name: objectID"})," mappings, to override the SuiNS names. For development\nonly. Use this at your own risk, may render some sites with legitimate SuiNS names unusable."]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.code,{children:"FALLBACK_PORTAL"}),": This is related only to the service worker portal. The fallback portal should\nbe a server-side portal that is used in cases where some browsers do not support service workers."]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"deploying-the-portal",children:"Deploying the Portal"}),"\n",(0,l.jsx)(n.p,{children:"To run the portal locally you can either use a Docker container or a local development environment."}),"\n",(0,l.jsx)(n.p,{children:"You can run the portal via Docker for a quick setup, or use a local development environment if you\nwant to modify the code or contribute to the project."}),"\n",(0,l.jsx)(n.h4,{id:"docker",children:"Docker"}),"\n",(0,l.jsx)(n.p,{children:"First, make sure you have Docker installed on your system."}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ docker --version\n"})}),"\n",(0,l.jsxs)(n.p,{children:["If it is not installed, follow the instructions on the ",(0,l.jsx)(n.code,{children:"[Docker website][get-docker]"}),"."]}),"\n",(0,l.jsx)(n.p,{children:"Then, build the Docker image with:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ docker build -f portal/docker/server/Dockerfile -t server-portal . --build-arg ENABLE_SENTRY=false --no-cache\n"})}),"\n",(0,l.jsx)(n.p,{children:"Finally, run the Docker container:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ docker run --env-file ./portal/server/.env.local -p 3000:3000 server-portal\n"})}),"\n",(0,l.jsxs)(n.p,{children:["Browse the sites at ",(0,l.jsx)(n.code,{children:"localhost:3000"}),"."]}),"\n",(0,l.jsx)(n.h4,{id:"local-development",children:"Local Development"}),"\n",(0,l.jsxs)(n.p,{children:["This requires having the ",(0,l.jsx)(n.a,{href:"https://bun.sh/",children:(0,l.jsx)(n.code,{children:"bun"})})," tool installed:"]}),"\n",(0,l.jsx)(n.p,{children:"Check if bun is installed with:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ bun --version\n"})}),"\n",(0,l.jsx)(n.p,{children:"If not installed, run the following command:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ curl -fsSL https://bun.sh/install | bash\n"})}),"\n",(0,l.jsx)(n.p,{children:"Install the dependencies:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ cd portal\n$ bun install\n"})}),"\n",(0,l.jsx)(n.p,{children:"To run a server-side portal:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ bun run server\n"})}),"\n",(0,l.jsx)(n.p,{children:"To run a service-worker portal:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-sh",children:"$ bun build:worker\n$ bun run worker\n"})}),"\n",(0,l.jsxs)(n.p,{children:["To serve one of the portals. Typically, you will find it served at ",(0,l.jsx)(n.code,{children:"localhost:3000"})," (for the server side portal) or ",(0,l.jsx)(n.code,{children:"localhost:8080"})," for the service worker (but check the output of the serve\ncommand)."]}),"\n",(0,l.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,l.jsxs)(n.p,{children:["As a next step, you can bring your own domain to the portal. This is useful if you want to use\nWalrus Sites to host your site under a custom domain name. Learn how to do this in\nthe ",(0,l.jsx)(n.code,{children:"[next section][own-domain]"}),"."]}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://docs.docker.com/get-docker/",children:"get-docker"}),"\n",(0,l.jsx)(n.a,{href:"https://vercel.com/docs/edge-config",children:"edge-config"}),"\n",(0,l.jsx)(n.a,{href:"/docs/walrus-sites/bring-your-own-domain",children:"own-domain"})]})]})}function S(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(k,{...e})}):k(e)}},8885:(e,n,r)=>{r.d(n,{R:()=>t,x:()=>i});var s=r(9378);const l={},o=s.createContext(l);function t(e){const n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);