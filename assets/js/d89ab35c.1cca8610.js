"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[1620],{7565:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>r,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"walrus-sites/routing","title":"Specifying Headers, Routing, and Metadata","description":"Guide to configuring custom headers, client-side routing, and metadata for Walrus Sites using ws-resources.json.","source":"@site/../content/walrus-sites/routing.mdx","sourceDirName":"walrus-sites","slug":"/walrus-sites/routing","permalink":"/docs/walrus-sites/routing","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/walrus-sites/routing.mdx","tags":[],"version":"current","frontMatter":{"title":"Specifying Headers, Routing, and Metadata","description":"Guide to configuring custom headers, client-side routing, and metadata for Walrus Sites using ws-resources.json.","keywords":["walrus sites","headers","routing","metadata","ws-resources","configuration","client-side routing","spa"]},"sidebar":"sitesSidebar","previous":{"title":"Configuring the Site Builder","permalink":"/docs/walrus-sites/builder-config"},"next":{"title":"Linking from and to Walrus Sites","permalink":"/docs/walrus-sites/linking"}}');var t=n(2714),o=n(8885);const r={title:"Specifying Headers, Routing, and Metadata",description:"Guide to configuring custom headers, client-side routing, and metadata for Walrus Sites using ws-resources.json.",keywords:["walrus sites","headers","routing","metadata","ws-resources","configuration","client-side routing","spa"]},d=void 0,l={},a=[{value:"The <code>ws-resources.json</code> file",id:"the-ws-resourcesjson-file",level:2},{value:"Specifying HTTP Response Headers",id:"specifying-http-response-headers",level:2},{value:"Default Headers",id:"default-headers",level:3},{value:"Specifying Client-Side Routing",id:"specifying-client-side-routing",level:2},{value:"Displaying the Site Object on Wallets and Explorers",id:"displaying-the-site-object-on-wallets-and-explorers",level:2},{value:"Site Name (<code>site_name</code>)",id:"site-name-site_name",level:2},{value:"Site Object ID (<code>object_id</code>)",id:"site-object-id-object_id",level:2},{value:"Ignoring Files from Being Uploaded",id:"ignoring-files-from-being-uploaded",level:2}];function c(e){const s={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Term:n}=s;return n||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(s.p,{children:["In its base configuration, Walrus Sites serves static assets through a portal. However, many modern\nweb applications require more advanced features, such as custom headers and ",(0,t.jsx)(n,{lookup:"Client",children:"client"}),"-side routing."]}),"\n",(0,t.jsxs)(s.p,{children:["Therefore, the site-builder can read a ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," configuration file, in which you can\ndirectly specify resource headers and routing rules."]}),"\n",(0,t.jsxs)(s.h2,{id:"the-ws-resourcesjson-file",children:["The ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file"]}),"\n",(0,t.jsxs)(s.p,{children:["This file is optionally placed in the root of the site directory, and it is ",(0,t.jsx)(s.em,{children:"not"})," uploaded with the\nsite's resources (in other words, the file is not part of the resulting Walrus Site and is not\nserved by the portal)."]}),"\n",(0,t.jsxs)(s.p,{children:["If you don't want to use this default location, you can specify the path to the configuration file\nwith the ",(0,t.jsx)(s.code,{children:"--ws-resources"})," flag when running the ",(0,t.jsx)(s.code,{children:"deploy"}),", ",(0,t.jsx)(s.code,{children:"publish"})," or ",(0,t.jsx)(s.code,{children:"update"})," commands."]}),"\n",(0,t.jsx)(s.p,{children:"The file is JSON-formatted, and looks like the following:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'{\n  "headers": {\n    "/index.html": {\n    "Content-Type": "text/html; charset=utf-8",\n    "Cache-Control": "max-age=3500"\n    }\n  },\n  "routes": {\n    "/*": "/index.html",\n    "/accounts/*": "/accounts.html",\n    "/path/assets/*": "/assets/asset_router.html"\n  },\n  "metadata": {\n    "link": "https://subdomain.wal.app",\n    "image_url": "https://www.walrus.xyz/walrus-site",\n    "description": "This is a walrus site.",\n    "project_url": "https://github.com/MystenLabs/walrus-sites/",\n    "creator": "MystenLabs"\n  },\n  "site_name": "My Walrus Site",\n  "object_id": "0xe674c144119a37a0ed9cef26a962c3fdfbdbfd86a3b3db562ee81d5542a4eccf",\n  "ignore": ["/private/*", "/secret.txt", "/images/tmp/*"]\n}\n'})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file, expects the field names to be in ",(0,t.jsx)(s.code,{children:"snake_case"})]})}),"\n",(0,t.jsxs)(s.p,{children:["We now describe in detail six sections of the configuration file: ",(0,t.jsx)(s.code,{children:"headers"}),", ",(0,t.jsx)(s.code,{children:"routes"}),",\n",(0,t.jsx)(s.code,{children:"metadata"}),", ",(0,t.jsx)(s.code,{children:"site_name"}),", ",(0,t.jsx)(s.code,{children:"object_id"})," and the ",(0,t.jsx)(s.code,{children:"ignore"})," section."]}),"\n",(0,t.jsx)(s.h2,{id:"specifying-http-response-headers",children:"Specifying HTTP Response Headers"}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"headers"})," section allows you to specify custom HTTP response headers for specific resources.\nThe keys in the ",(0,t.jsx)(s.code,{children:"headers"})," object are the paths of the resources, and the values are lists of\nkey-value pairs corresponding to the headers that the portal will attach to the response."]}),"\n",(0,t.jsxs)(s.p,{children:["For example, in the configuration above, the file ",(0,t.jsx)(s.code,{children:"index.html"})," will be served with the\n",(0,t.jsx)(s.code,{children:"Content-Type"})," header set to ",(0,t.jsx)(s.code,{children:"text/html; charset=utf-8"})," and the ",(0,t.jsx)(s.code,{children:"Cache-Control"})," header set to\n",(0,t.jsx)(s.code,{children:"max-age=3500"}),"."]}),"\n",(0,t.jsx)(s.p,{children:"This mechanism allows you to control various aspects of the resource delivery, such as caching,\nencoding, and content types."}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["The resource path is always represented as starting from the root ",(0,t.jsx)(s.code,{children:"/"}),"."]})}),"\n",(0,t.jsx)(s.h3,{id:"default-headers",children:"Default Headers"}),"\n",(0,t.jsxs)(s.p,{children:["By default, no headers need to be specified, and the ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file can be omitted. The\nsite-builder will automatically try to infer the ",(0,t.jsx)(s.code,{children:"Content-Type"})," header based on the file extension,\nand set the ",(0,t.jsx)(s.code,{children:"Content-Encoding"})," to ",(0,t.jsx)(s.code,{children:"identity"})," (no transformation)."]}),"\n",(0,t.jsxs)(s.p,{children:["In case the content type cannot be inferred, the ",(0,t.jsx)(s.code,{children:"Content-Type"})," will be set to\n",(0,t.jsx)(s.code,{children:"application/octet-stream"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:["These defaults will be overridden by any headers specified in the ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file."]}),"\n",(0,t.jsxs)(s.h2,{id:"specifying-client-side-routing",children:["Specifying ","Client","-Side Routing"]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"routes"})," section allows you to specify ","client","-side routing rules for your site. This is useful\nwhen you want to use a single-page application (SPA) framework, such as React or Angular."]}),"\n",(0,t.jsxs)(s.p,{children:["The configuration in the ",(0,t.jsx)(s.code,{children:"routes"})," object is a mapping from route keys to resource paths."]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsxs)(s.strong,{children:[(0,t.jsx)(s.code,{children:"routes"})," keys"]})," are path patterns in the form ",(0,t.jsx)(s.code,{children:"/path/to/some/*"}),", where the ",(0,t.jsx)(s.code,{children:"*"})," character\nrepresents a wildcard."]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["Currently, the wildcard ",(0,t.jsx)(s.em,{children:"can only be specified at the end of the path"}),".\nTherefore, ",(0,t.jsx)(s.code,{children:"/path/*"})," is a valid path, while ",(0,t.jsx)(s.code,{children:"/path/*/to"})," and ",(0,t.jsx)(s.code,{children:"*/path/to/*"})," are not."]})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsxs)(s.strong,{children:[(0,t.jsx)(s.code,{children:"routes"})," values"]})," are the resource paths that should be served when the route key is matched."]}),"\n",(0,t.jsx)(s.admonition,{title:"Important",type:"danger",children:(0,t.jsxs)(s.p,{children:["The paths in the values ",(0,t.jsx)(s.strong,{children:"must"})," be valid resource paths, meaning that they must be present among\nthe site's resources. The Walrus sites contract will ",(0,t.jsx)(s.strong,{children:"abort"})," if the ",(0,t.jsx)(n,{lookup:"User",children:"user"})," tries to create a route\nthat points to a non-existing resource."]})}),"\n",(0,t.jsx)(s.p,{children:"The simple routing algorithm is as follows:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["Whenever a resource path ",(0,t.jsx)(s.em,{children:"is not found among the sites resources"}),", the portal tries to match the\npath to the ",(0,t.jsx)(s.code,{children:"routes"}),"."]}),"\n",(0,t.jsxs)(s.li,{children:["All matching routes are then ",(0,t.jsx)(s.em,{children:"lexicographically ordered"}),", and the ",(0,t.jsx)(s.em,{children:"longest"})," match is chosen."]}),"\n",(0,t.jsx)(s.li,{children:"The resource corresponding to this longest match is then served."}),"\n"]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["In other words, the portal will ",(0,t.jsx)(s.em,{children:"always"})," serve a resource if present, and if not present will serve\nthe resource with the ",(0,t.jsx)(s.em,{children:"longest matching prefix"})," among the routes."]})}),"\n",(0,t.jsx)(s.p,{children:"Recall the example above:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'"routes": {\n  "/*": "/index.html",\n  "/path/*": "/accounts.html",\n  "/path/assets/*": "/assets/asset_router.html"\n}\n'})}),"\n",(0,t.jsx)(s.p,{children:"The following matchings will occur:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["browsing ",(0,t.jsx)(s.code,{children:"/any/other/test.html"})," will serve ",(0,t.jsx)(s.code,{children:"/index.html"}),";"]}),"\n",(0,t.jsxs)(s.li,{children:["browsing ",(0,t.jsx)(s.code,{children:"/path/test.html"})," will serve ",(0,t.jsx)(s.code,{children:"/accounts.html"}),", as it is a more specific match than the\nprevious one;"]}),"\n",(0,t.jsxs)(s.li,{children:["similarly, browsing ",(0,t.jsx)(s.code,{children:"/path/assets/test.html"})," will serve ",(0,t.jsx)(s.code,{children:"/assets/asset_router.html"}),"."]}),"\n"]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.code,{children:"/index.html"}),", ",(0,t.jsx)(s.code,{children:"/accounts.html"}),", and ",(0,t.jsx)(s.code,{children:"/assets/asset_router.html"})," are all existing resources on the\nWalrus Sites object on Sui."]}),"\n",(0,t.jsx)(s.h2,{id:"displaying-the-site-object-on-wallets-and-explorers",children:"Displaying the Site Object on Wallets and Explorers"}),"\n",(0,t.jsxs)(s.p,{children:["It's possible to make your Site object prettier by displaying information about it on Sui explorers\nand wallets by using the ",(0,t.jsx)(s.code,{children:"metadata"})," field. This is useful for adding human-readable information\nabout the site. For example, you can add a link to your site's homepage, an image of your site's\nlogo, etc."]}),"\n",(0,t.jsxs)(s.p,{children:["As you can see from the example above, the fields correspond to the basic set of properties\nsuggested by the\n",(0,t.jsx)(s.a,{href:"https://docs.sui.io/standards/display#display-properties",children:"Sui Display object standard"}),"."]}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'"metadata": {\n    "link": "https://subdomain.wal.app",\n    "image_url": "https://www.walrus.xyz/walrus-site",\n    "description": "This is a walrus site.",\n    "project_url": "https://github.com/MystenLabs/walrus-sites/",\n    "creator": "MystenLabs"\n  }\n'})}),"\n",(0,t.jsxs)(s.p,{children:["All metadata fields are optional, and can be omitted if not needed. There are some default values\nspecified in the site-builder CLI, which can be overridden by the ","user","."]}),"\n",(0,t.jsx)(s.p,{children:"It is recommended to use the above fields like this:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"link"}),": Add a link to your site's homepage."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"image_url"}),": Include a URL to your site's logo which will be displayed on your wallet. For\nexample you can place a link to your sites favicon."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"description"}),": Add a brief description of your site."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"project_url"}),": If your site is open-source, add a link to your site's GitHub repository."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.code,{children:"creator"}),": Add the name of your company, group, or individual creator of your site."]}),"\n"]}),"\n",(0,t.jsxs)(s.h2,{id:"site-name-site_name",children:["Site Name (",(0,t.jsx)(s.code,{children:"site_name"}),")"]}),"\n",(0,t.jsxs)(s.p,{children:["You can set a Name for your Walrus Site, via the optional ",(0,t.jsx)(s.code,{children:"site_name"})," field in your\n",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file."]}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["In case you have also provided a Site Name via the ",(0,t.jsx)(s.code,{children:"--site-name"})," cli flag, the cli flag\nwill take priority over the ",(0,t.jsx)(s.code,{children:"site_name"})," field in the ",(0,t.jsx)(s.code,{children:"ws-resources.json"}),", which will be\noverwritten."]})}),"\n",(0,t.jsx)(s.admonition,{type:"note",children:(0,t.jsxs)(s.p,{children:["If a Site Name is not provided at all (neither through the ",(0,t.jsx)(s.code,{children:"--site-name"})," cli flag, nor\nthrough the ",(0,t.jsx)(s.code,{children:"site_name"})," field in ",(0,t.jsx)(s.code,{children:"ws-resources.json"}),"), then a default name will be used."]})}),"\n",(0,t.jsxs)(s.h2,{id:"site-object-id-object_id",children:["Site Object ID (",(0,t.jsx)(s.code,{children:"object_id"}),")"]}),"\n",(0,t.jsxs)(s.p,{children:["The optional ",(0,t.jsx)(s.code,{children:"object_id"})," field in your ",(0,t.jsx)(s.code,{children:"ws-resources.json"})," file stores the Sui Object ID of your\ndeployed Walrus Site."]}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.strong,{children:"Role in Deployment:"})}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"site-builder deploy"})," command primarily uses this field to identify an existing site for updates.\nIf a valid ",(0,t.jsx)(s.code,{children:"object_id"})," is present, ",(0,t.jsx)(s.code,{children:"deploy"})," will target that site for modifications.\nIf this field is missing (and no ",(0,t.jsx)(s.code,{children:"--object-id"})," CLI flag is used), ",(0,t.jsx)(s.code,{children:"deploy"})," will publish a new site.\nIf successful, then the command automatically populates this ",(0,t.jsx)(s.code,{children:"object_id"})," field in your ",(0,t.jsx)(s.code,{children:"ws-resources.json"}),"."]}),"\n",(0,t.jsx)(s.h2,{id:"ignoring-files-from-being-uploaded",children:"Ignoring Files from Being Uploaded"}),"\n",(0,t.jsxs)(s.p,{children:["You can use the optional ",(0,t.jsx)(s.code,{children:"ignore"})," field to exclude certain files or folders from being published.\nThis is useful when you want to keep development files, secrets, or temporary assets out of\nthe final build."]}),"\n",(0,t.jsxs)(s.p,{children:["The ",(0,t.jsx)(s.code,{children:"ignore"})," field is a list of resource paths to skip. Each pattern must start with a ",(0,t.jsx)(s.code,{children:"/"}),",\nand may end with a ",(0,t.jsx)(s.code,{children:"*"})," to indicate a wildcard match."]}),"\n",(0,t.jsx)(s.p,{children:"For example:"}),"\n",(0,t.jsx)(s.pre,{children:(0,t.jsx)(s.code,{className:"language-json",children:'"ignore": [\n  "/private/*",\n  "/secret.txt",\n  "/images/tmp/*"\n]\n'})}),"\n",(0,t.jsxs)(s.p,{children:["This configuration will skip all files inside the ",(0,t.jsx)(s.code,{children:"/private/"})," and ",(0,t.jsx)(s.code,{children:"/images/tmp/"})," directories,\nas well as a specific file ",(0,t.jsx)(s.code,{children:"/secret.txt"}),"."]}),"\n",(0,t.jsxs)(s.blockquote,{children:["\n",(0,t.jsxs)(s.p,{children:["Wildcards are only supported in the ",(0,t.jsx)(s.strong,{children:"last position"})," of the path (e.g., ",(0,t.jsx)(s.code,{children:"/foo/*"})," is valid,\nbut ",(0,t.jsx)(s.code,{children:"/foo/*/bar"})," is not)."]}),"\n"]})]})}function h(e={}){const{wrapper:s}={...(0,o.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},8885:(e,s,n)=>{n.d(s,{R:()=>r,x:()=>d});var i=n(9378);const t={},o=i.createContext(t);function r(e){const s=i.useContext(o);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function d(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);