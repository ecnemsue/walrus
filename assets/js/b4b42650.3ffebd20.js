"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[4356],{8024:(e,t,s)=>{s.r(t),s.d(t,{assets:()=>c,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>n,toc:()=>l});const n=JSON.parse('{"id":"dev-guide/sui-struct","title":"Sui Structures","description":"Technical reference for Walrus Sui smart contracts including blob objects, storage resources, and system events for developers.","source":"@site/../content/dev-guide/sui-struct.mdx","sourceDirName":"dev-guide","slug":"/dev-guide/sui-struct","permalink":"/docs/dev-guide/sui-struct","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/dev-guide/sui-struct.mdx","tags":[],"version":"current","frontMatter":{"title":"Sui Structures","description":"Technical reference for Walrus Sui smart contracts including blob objects, storage resources, and system events for developers.","keywords":["walrus","sui structures","smart contracts","blob objects","storage resources","events","system object","staking","move contracts"]},"sidebar":"docsSidebar","previous":{"title":"Storage Costs","permalink":"/docs/dev-guide/costs"},"next":{"title":"Data Security","permalink":"/docs/dev-guide/data-security"}}');var o=s(2714),r=s(8885);const a={title:"Sui Structures",description:"Technical reference for Walrus Sui smart contracts including blob objects, storage resources, and system events for developers.",keywords:["walrus","sui structures","smart contracts","blob objects","storage resources","events","system object","staking","move contracts"]},i=void 0,c={},l=[{value:"Blob and Storage Objects",id:"blob-and-storage-objects",level:2},{value:"Events",id:"events",level:2},{value:"System and Staking Information",id:"system-and-staking-information",level:2}];function d(e){const t={a:"a",code:"code",h2:"h2",p:"p",pre:"pre",...(0,r.R)(),...e.components},{Term:s}=t;return s||function(e,t){throw new Error("Expected "+(t?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.p,{children:"This section is optional and enables advanced use cases, leveraging Sui smart contract interactions\nwith the Walrus smart contract."}),"\n",(0,o.jsxs)(t.p,{children:["You can interact with Walrus purely through the ",(0,o.jsx)(s,{lookup:"Client",children:"client"})," CLI, and JSON or HTTP APIs provided, without\nquerying or executing transactions on Sui directly. However, Walrus uses Sui to manage its metadata\nand smart contract developers can read information about the Walrus system, as well as stored ",(0,o.jsx)(s,{lookup:"Blob",children:"blobs"}),",\non Sui."]}),"\n",(0,o.jsxs)(t.p,{children:["The\n",(0,o.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts",children:"Move code of the Walrus system contracts"}),"\nis available and you can find an\n",(0,o.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/docs/examples",children:"example smart contract"})," that\nimplements a wrapped ","blob","."]}),"\n",(0,o.jsx)(t.p,{children:"The following sections provide further insights into the contract and an\noverview of how you may use Walrus objects in your own Sui smart contracts."}),"\n",(0,o.jsxs)(t.h2,{id:"blob-and-storage-objects",children:["Blob"," and Storage Objects"]}),"\n",(0,o.jsxs)(t.p,{children:["Walrus ","blobs"," are represented as Sui objects of type ",(0,o.jsx)(t.code,{children:"Blob"}),". A ","blob"," is first registered, indicating\nthat the ",(0,o.jsx)(s,{lookup:"Storage node",children:"storage nodes"})," should expect slivers from a ",(0,o.jsx)(s,{lookup:"Blob ID",children:"Blob ID"})," to be stored. Then a ","blob"," is certified,\nindicating that a sufficient number of slivers have been stored to guarantee the ","blob","'s\navailability. When a ","blob"," is certified, its ",(0,o.jsx)(t.code,{children:"certified_epoch"})," field contains the epoch in which it\nwas certified."]}),"\n",(0,o.jsxs)(t.p,{children:["A ",(0,o.jsx)(t.code,{children:"Blob"})," object is always associated with a ",(0,o.jsx)(t.code,{children:"Storage"})," object, reserving enough space for\na long enough period for the ","blob","'s storage. A certified ","blob"," is available for the period the\nunderlying storage resource guarantees storage."]}),"\n",(0,o.jsxs)(t.p,{children:["Concretely, ",(0,o.jsx)(t.code,{children:"Blob"})," and ",(0,o.jsx)(t.code,{children:"Storage"})," objects have the following fields, which can be read through the\nSui SDKs:"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-move",children:"/// Reservation for storage for a given period, which is inclusive start, exclusive end.\npublic struct Storage has key, store {\n    id: UID,\n    start_epoch: u32,\n    end_epoch: u32,\n    storage_size: u64,\n}\n\n/// The blob structure represents a blob that has been registered to with some storage,\n/// and then may eventually be certified as being available in the system.\npublic struct Blob has key, store {\n    id: UID,\n    registered_epoch: u32,\n    blob_id: u256,\n    size: u64,\n    encoding_type: u8,\n    // Stores the epoch first certified if any.\n    certified_epoch: option::Option<u32>,\n    storage: Storage,\n    // Marks if this blob can be deleted.\n    deletable: bool,\n}\n"})}),"\n",(0,o.jsxs)(t.p,{children:["Public functions associated with these objects can be found in the respective ",(0,o.jsxs)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts/walrus/sources/system/storage_resource.move",children:[(0,o.jsx)(t.code,{children:"storage_resource"}),"\nmove module"]}),"\nand ",(0,o.jsxs)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts/walrus/sources/system/blob.move",children:[(0,o.jsx)(t.code,{children:"blob"})," move module"]}),".\nStorage resources can be split and merged in time and data capacity, and can be transferred between\nusers allowing complex contracts to be created."]}),"\n",(0,o.jsx)(t.h2,{id:"events",children:"Events"}),"\n",(0,o.jsxs)(t.p,{children:["Walrus uses ",(0,o.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/events.move",children:"custom Sui events"}),"\nextensively to notify ","storage nodes"," of updates concerning stored ","Blobs"," and the state of the network.\nApplications may also use Sui RPC facilities to observe Walrus related events."]}),"\n",(0,o.jsxs)(t.p,{children:["When a ","blob"," is first registered, a ",(0,o.jsx)(t.code,{children:"BlobRegistered"})," event is emitted that informs ","storage nodes","\nthat they should expect slivers associated with its ","Blob ID",". Eventually when the ","blob"," is\ncertified, a ",(0,o.jsx)(t.code,{children:"BlobCertified"})," is emitted containing information about the ","blob ID"," and the epoch\nafter which the ","blob"," will be deleted. Before that epoch the ","blob"," is guaranteed to be available."]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"BlobCertified"})," event with ",(0,o.jsx)(t.code,{children:"deletable"})," set to false and an ",(0,o.jsx)(t.code,{children:"end_epoch"})," in the future indicates\nthat the ","blob"," will be available until this epoch. A light ","client"," proof that this event was emitted\nfor a ","blob ID"," constitutes a proof of availability for the data with this ","blob ID",". When a deletable\n","blob"," is deleted, a ",(0,o.jsx)(t.code,{children:"BlobDeleted"})," event is emitted."]}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.code,{children:"InvalidBlobID"})," event is emitted when ","storage nodes"," detect an incorrectly encoded ","blob",".\nAnyone attempting a read on such a ","blob"," is guaranteed to also detect it as invalid."]}),"\n",(0,o.jsxs)(t.p,{children:["System level events such as ",(0,o.jsx)(t.code,{children:"EpochChangeStart"})," and ",(0,o.jsx)(t.code,{children:"EpochChangeDone"})," indicate transitions\nbetween epochs. And associated events such as ",(0,o.jsx)(t.code,{children:"ShardsReceived"}),", ",(0,o.jsx)(t.code,{children:"EpochParametersSelected"}),",\nand ",(0,o.jsx)(t.code,{children:"ShardRecoveryStart"})," indicate ","storage node"," level events related to epoch transitions,\n",(0,o.jsx)(s,{lookup:"Shard",children:"shard"})," migrations and epoch parameters."]}),"\n",(0,o.jsx)(t.h2,{id:"system-and-staking-information",children:"System and Staking Information"}),"\n",(0,o.jsxs)(t.p,{children:["The ",(0,o.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/blob/main/contracts/walrus/sources/system/system_state_inner.move",children:"Walrus system object"}),"\ncontains metadata about the available and used storage, as well as the price of storage per KiB of\nstorage in ",(0,o.jsx)(s,{lookup:"FROST",children:"FROST"}),". The committee structure within the system object can be used to read the current\nepoch number, as well as information about the committee. Committee changes between epochs are\nmanaged by a set of ",(0,o.jsx)(t.a,{href:"https://github.com/MystenLabs/walrus/tree/main/contracts/walrus/sources/staking",children:"staking contracts"}),"\nthat implement a full delegated proof of stake system based on the ",(0,o.jsx)(s,{lookup:"WAL",children:"WAL"})," token."]})]})}function h(e={}){const{wrapper:t}={...(0,r.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},8885:(e,t,s)=>{s.d(t,{R:()=>a,x:()=>i});var n=s(9378);const o={},r=n.createContext(o);function a(e){const t=n.useContext(r);return n.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function i(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),n.createElement(r.Provider,{value:t},e.children)}}}]);