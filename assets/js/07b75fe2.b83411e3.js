"use strict";(globalThis.webpackChunkwalrus_docusaurus=globalThis.webpackChunkwalrus_docusaurus||[]).push([[6857],{3244:(e,s,t)=>{t.r(s),t.d(s,{assets:()=>l,contentTitle:()=>a,default:()=>c,frontMatter:()=>o,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"walrus-sites/overview","title":"Technical Overview","description":"Technical deep dive into Walrus Sites architecture, Sui objects, resource storage, and site rendering pathways.","source":"@site/../content/walrus-sites/overview.mdx","sourceDirName":"walrus-sites","slug":"/walrus-sites/overview","permalink":"/docs/walrus-sites/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/MystenLabs/walrus/tree/main/docs/../content/walrus-sites/overview.mdx","tags":[],"version":"current","frontMatter":{"title":"Technical Overview","description":"Technical deep dive into Walrus Sites architecture, Sui objects, resource storage, and site rendering pathways.","keywords":["walrus sites","technical overview","sui objects","dynamic fields","site rendering","portal architecture","site builder","domain isolation"]},"sidebar":"sitesSidebar","previous":{"title":"Writing Your Workflow","permalink":"/docs/walrus-sites/ci-cd-gh-workflow"},"next":{"title":"The Walrus Sites Portal","permalink":"/docs/walrus-sites/portal"}}');var r=t(2714),n=t(8885);const o={title:"Technical Overview",description:"Technical deep dive into Walrus Sites architecture, Sui objects, resource storage, and site rendering pathways.",keywords:["walrus sites","technical overview","sui objects","dynamic fields","site rendering","portal architecture","site builder","domain isolation"]},a=void 0,l={},h=[{value:"High-level picture",id:"high-level-picture",level:2},{value:"The Walrus Sites objects on Sui",id:"the-walrus-sites-objects-on-sui",level:3},{value:"The Site Rendering Path",id:"the-site-rendering-path",level:3},{value:"Browsing and Domain Isolation",id:"browsing-and-domain-isolation",level:3},{value:"Walrus Site portals",id:"walrus-site-portals",level:2},{value:"Portal types",id:"portal-types",level:3},{value:"The End-to-End Resolution of a Walrus Site",id:"the-end-to-end-resolution-of-a-walrus-site",level:3},{value:"The Site Builder",id:"the-site-builder",level:2}];function d(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,n.R)(),...e.components},{Term:i}=s;return i||function(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Term",!0),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(s.p,{children:"In the following sections, we delve deeper in the technical specification of Walrus Sites."}),"\n",(0,r.jsx)(s.h2,{id:"high-level-picture",children:"High-level picture"}),"\n",(0,r.jsxs)(s.p,{children:["Walrus Sites are enabled by Sui and Walrus. The resources of the Walrus Site (",(0,r.jsx)(s.code,{children:"html"}),", ",(0,r.jsx)(s.code,{children:"css"}),", ",(0,r.jsx)(s.code,{children:"js"}),",\nimages, etc.) are stored on Walrus, while the main entry point to it is an object stored on Sui,\nwhich contains the metadata for the site and point to the Walrus ",(0,r.jsx)(i,{lookup:"Blob",children:"blob"})," IDs."]}),"\n",(0,r.jsx)(s.h3,{id:"the-walrus-sites-objects-on-sui",children:"The Walrus Sites objects on Sui"}),"\n",(0,r.jsxs)(s.p,{children:["A Walrus ",(0,r.jsx)(s.code,{children:"Site"})," is represented on Sui as a very simple object:"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-move",children:"struct Site has key, store {\n    id: UID,\n    name: String,\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:["The resources associated with this site are then added to this object as ",(0,r.jsx)(s.a,{href:"https://docs.sui.io/concepts/versioning#dynamic-fields",children:"dynamic\nfields"})," of type ",(0,r.jsx)(s.code,{children:"Resource"}),":"]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-move",children:"struct Resource has store, drop {\n    path: String,\n    // The walrus blob id containing the bytes for this resource\n    blob_id: u256,\n    \u22ee\n}\n"})}),"\n",(0,r.jsx)(s.p,{children:"Importantly, each resource contains:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["the ",(0,r.jsx)(s.code,{children:"path"})," of the resource, for example ",(0,r.jsx)(s.code,{children:"/index.html"})," (all the paths are always represented as\nstarting from root ",(0,r.jsx)(s.code,{children:"/"}),");"]}),"\n",(0,r.jsxs)(s.li,{children:["the ",(0,r.jsx)(s.code,{children:"blob_id"}),", which is the Walrus ",(0,r.jsx)(i,{lookup:"Blob ID",children:"blob ID"})," where the resource can be found; and"]}),"\n",(0,r.jsx)(s.li,{children:"additional fields, that will be explained later in the documentation."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["These ",(0,r.jsx)(s.code,{children:"Resource"})," dynamic fields are keyed with a struct of type ",(0,r.jsx)(s.code,{children:"ResourcePath"})]}),"\n",(0,r.jsx)(s.pre,{children:(0,r.jsx)(s.code,{className:"language-move",children:"struct ResourcePath has copy, store, drop {\n    path: String,\n}\n"})}),"\n",(0,r.jsxs)(s.p,{children:["This struct just holds the string of the path (",(0,r.jsx)(s.code,{children:"/index.html"}),"); having a separate type ensures that\nwe will not have namespace collisions with other dynamic fields, possibly added by other packages."]}),"\n",(0,r.jsxs)(s.p,{children:["To see this in action, look at ",(0,r.jsx)(s.a,{href:"https://suiscan.xyz/testnet/object/0xd20b90149409ba5d005d4a2cd981db9494bc3cdb2f04c47ca1af98dd8f71610a",children:"a Walrus Site in the\nexplorer"}),",\nand check its dynamic fields."]}),"\n",(0,r.jsx)(s.h3,{id:"the-site-rendering-path",children:"The Site Rendering Path"}),"\n",(0,r.jsxs)(s.p,{children:["Given the Sui object ID of a Walrus Site, it is easy to look up the resources that compose it\nby looking at the dynamic fields, and then fetch these resources from Walrus using the ","blob ID","\ncontained in the ",(0,r.jsx)(s.code,{children:"Resource"})," struct."]}),"\n",(0,r.jsxs)(s.p,{children:["The only outstanding question is, therefore, how to perform these lookups on the ",(0,r.jsx)(i,{lookup:"Client",children:"client"}),". A few\napproaches are possible:"]}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["Having a server that accepts requests for a Sui object ID and possibly a path, and performs this\nresolution on behalf of the ","client",", serving back the resource as a standard HTML Response."]}),"\n",(0,r.jsxs)(s.li,{children:["Using a custom application on the ","client"," that has both a web browser and knowledge of how Walrus\nSites work, and can locally perform this resolution."]}),"\n",(0,r.jsx)(s.li,{children:"A hybrid approach based on service workers, where a service worker that is able to perform the\nresolution is installed in the browser from a portal."}),"\n"]}),"\n",(0,r.jsx)(s.p,{children:"All of these approaches are viable (the first has been used for similar applications in IPFS\ngateways, for example), and have trade-offs."}),"\n",(0,r.jsx)(s.p,{children:"Currently, we provide the server-side and the service-worker based approaches."}),"\n",(0,r.jsx)(s.h3,{id:"browsing-and-domain-isolation",children:"Browsing and Domain Isolation"}),"\n",(0,r.jsxs)(s.p,{children:["We must ensure that, when browsing multiple sites through a portal, for example the one hosted at\n",(0,r.jsx)(s.a,{href:"https://wal.app",children:"https://wal.app"}),", these sites are isolated. Isolation is necessary for security, and to ensure\nthat the wallet connection in the browser works as expected."]}),"\n",(0,r.jsxs)(s.p,{children:["To do so, we give each Walrus Site a specific ",(0,r.jsx)(s.em,{children:"subdomain"})," of the portal's domain. For example, the\nFlatland mint dApp is hosted at ",(0,r.jsx)(s.a,{href:"https://flatland.wal.app",children:"https://flatland.wal.app"}),", where the subdomain ",(0,r.jsx)(s.code,{children:"flatland"})," is\nuniquely associated to the object ID of the Walrus Site through SuiNS."]}),"\n",(0,r.jsxs)(s.p,{children:["Walrus Sites also work ",(0,r.jsx)(s.em,{children:"without"})," SuiNS: when a site is accessed through a self-hosted portal, or\nthrough a portal that supports Base36 domain resolution, a site can be browsed by using as\nsubdomain the Base36 encoding of the Sui object ID of the site."]}),"\n",(0,r.jsx)(s.admonition,{type:"danger",children:(0,r.jsxs)(s.p,{children:["The ",(0,r.jsx)(s.code,{children:"wal.app"})," portal does not support Base36 domain resolution; therefore,\n",(0,r.jsx)(s.a,{href:"https://58gr4pinoayuijgdixud23441t55jd94ugep68fsm72b8mwmq2.wal.app",children:"https://58gr4pinoayuijgdixud23441t55jd94ugep68fsm72b8mwmq2.wal.app"})," is not a valid URL. If you\nwant to access such a site, you should either use another portal or\n",(0,r.jsx)(s.a,{href:"/docs/walrus-sites/portal#running-a-local-portal",children:"host your own"}),"."]})}),"\n",(0,r.jsx)(s.p,{children:"Base36 was chosen for two reasons, forced by the subdomain standards:"}),"\n",(0,r.jsxs)(s.ol,{children:["\n",(0,r.jsx)(s.li,{children:"A subdomain can have at most 63 characters, while a Hex-encoded Sui object ID requires 64."}),"\n",(0,r.jsxs)(s.li,{children:["A subdomain is case ",(0,r.jsx)(s.em,{children:"insensitive"}),", ruling out other popular encodings, e.g., Base64 or Base58."]}),"\n"]}),"\n",(0,r.jsx)(s.h2,{id:"walrus-site-portals",children:"Walrus Site portals"}),"\n",(0,r.jsx)(s.h3,{id:"portal-types",children:"Portal types"}),"\n",(0,r.jsx)(s.p,{children:"As mentioned before, we provide two types of portals to browse Walrus Sites:"}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:["The server-side portal, which is a server that resolves a Walrus Site, returning it to the\nbrowser. The server-side portal is hosted at ",(0,r.jsx)(s.a,{href:"https://wal.app",children:"https://wal.app"}),". This portal only supports sites\nthat are associated with a SuiNS name."]}),"\n",(0,r.jsx)(s.li,{children:"The service-worker portal, which is a service worker that is installed in the browser and\nresolves a Walrus Site. The service-worker portal is no longer hosted at a specific domain, but\nthe code is still maintained so that it can be used by anyone."}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["We now show in greater detail how a Walrus Site is rendered in a ","client","'s browser using a generic\nportal. Depending on the different type of portal, some details may differ, but the general picture\nremains unchanged."]}),"\n",(0,r.jsx)(s.h3,{id:"the-end-to-end-resolution-of-a-walrus-site",children:"The End-to-End Resolution of a Walrus Site"}),"\n",(0,r.jsx)(s.p,{children:"The steps below all reference the following figure:"}),"\n",(0,r.jsx)(s.p,{children:(0,r.jsx)(s.img,{alt:"Walrus Site resolution",src:t(4550).A+"",width:"1480",height:"1288"})}),"\n",(0,r.jsxs)(s.ul,{children:["\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Site publishing"})," (step 0): The site developer publishes the Walrus Site using the\n",(0,r.jsx)(s.a,{href:"#the-site-builder",children:(0,r.jsx)(s.code,{children:"site-builder"})}),", or making use of a ",(0,r.jsx)(i,{lookup:"Publisher",children:"publisher"}),". Assume the developer uses the\nSuiNS name ",(0,r.jsx)(s.code,{children:"dapp.sui"})," to point to the object ID of the created Walrus Site."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Browsing starts"})," (step 1): A ","client"," browses ",(0,r.jsx)(s.code,{children:"dapp.wal.app/index.html"})," in their browser."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Site resolution"})," (steps 2-6): The portal interprets its ",(0,r.jsx)(s.em,{children:"origin"})," ",(0,r.jsx)(s.code,{children:"dapp.wal.app"}),", and makes\na SuiNS resolution for ",(0,r.jsx)(s.code,{children:"dapp.sui"}),", obtaining the related object ID. Using the object ID, it then\nfetches the dynamic fields of the object (also checking ",(0,r.jsx)(s.a,{href:"/docs/walrus-sites/portal",children:"redirects"}),"). From the\ndynamic fields, it selects the one for ",(0,r.jsx)(s.code,{children:"/index.html"}),", and extracts its Walrus ","blob ID"," and headers\n(see the ",(0,r.jsx)(s.a,{href:"/docs/walrus-sites/routing",children:"advanced section on headers"}),")."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsxs)(s.strong,{children:["Blob"," fetch"]})," (steps 7-11): Given the ","blob ID",", the portal queries a Walrus ",(0,r.jsx)(i,{lookup:"Aggregator",children:"aggregator"})," for the\n","blob"," data."]}),"\n",(0,r.jsxs)(s.li,{children:[(0,r.jsx)(s.strong,{children:"Returning the response"})," (steps 12-13): Now that the portal has the bytes for ",(0,r.jsx)(s.code,{children:"/index.html"}),", and\nits headers, it can craft a response that is then rendered by the\nbrowser."]}),"\n"]}),"\n",(0,r.jsxs)(s.p,{children:["These steps are executed for all resources the browser may query thereafter (for example, if\n",(0,r.jsx)(s.code,{children:"/index.html"})," points to ",(0,r.jsx)(s.code,{children:"assets/cat.png"}),")."]}),"\n",(0,r.jsx)(s.h2,{id:"the-site-builder",children:"The Site Builder"}),"\n",(0,r.jsxs)(s.p,{children:['To facilitate the creation of Walrus Sites, we provide the "site builder" tool. The site builder\ntakes care of creating Walrus Sites object on Sui, with the correct structure, and stores the site\nresources to Walrus. Refer to the ',(0,r.jsx)(s.a,{href:"/docs/walrus-sites/tutorial",children:"tutorial"})," for setup and usage instructions."]})]})}function c(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,r.jsx)(s,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},4550:(e,s,t)=>{t.d(s,{A:()=>i});const i=t.p+"assets/images/walrus-sites-portal-diagram-c8b234413cab73e16bfd80740cd76acd.svg"},8885:(e,s,t)=>{t.d(s,{R:()=>o,x:()=>a});var i=t(9378);const r={},n=i.createContext(r);function o(e){const s=i.useContext(n);return i.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(n.Provider,{value:s},e.children)}}}]);